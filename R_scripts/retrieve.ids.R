#!/usr/bin/R

args<-commandArgs(TRUE)

dict <- read.table(file="/home/dgarrido/project/data/all.dates",header=F,sep="\t",as.is=T)
colnames(dict)<-c("id","year")

names<-c("PTHR10010","PTHR10024","PTHR10027","PTHR10037","PTHR10075","PTHR10082","PTHR10104","PTHR10125","PTHR10166","PTHR10199",
         "PTHR10217","PTHR10264","PTHR10283","PTHR10306","PTHR10332","PTHR10334","PTHR10361","PTHR10504","PTHR10519","PTHR10529",
         "PTHR10546","PTHR10555","PTHR10559","PTHR10570","PTHR10582","PTHR10583","PTHR10671","PTHR10686","PTHR10694","PTHR10760",
         "PTHR10778","PTHR10796","PTHR10822","PTHR10827","PTHR10877","PTHR10913","PTHR10915","PTHR11003","PTHR11022","PTHR11036",
         "PTHR11073","PTHR11102","PTHR11304","PTHR11309","PTHR11334","PTHR11337","PTHR11339","PTHR11348","PTHR11385","PTHR11388",
         "PTHR11412","PTHR11417","PTHR11431","PTHR11453","PTHR11471","PTHR11480","PTHR11481","PTHR11486","PTHR11515","PTHR11527",
         "PTHR11528","PTHR11537","PTHR11585","PTHR11616","PTHR11618","PTHR11639","PTHR11640","PTHR11654","PTHR11662","PTHR11683",
         "PTHR11689","PTHR11690","PTHR11691","PTHR11738","PTHR11785","PTHR11814","PTHR11827","PTHR11848","PTHR11860","PTHR11861",
         "PTHR11866","PTHR11890","PTHR11923","PTHR11955","PTHR11973","PTHR12011","PTHR12027","PTHR12101","PTHR12106","PTHR12207",
         "PTHR12223","PTHR12231","PTHR12385","PTHR12424","PTHR12929","PTHR13771","PTHR13814","PTHR13869","PTHR14340","PTHR18945",
         "PTHR22923","PTHR22924","PTHR22950","PTHR22992","PTHR23036","PTHR23037","PTHR23050","PTHR23055","PTHR23097","PTHR23192",
         "PTHR23213","PTHR23220","PTHR23277","PTHR23282","PTHR23412","PTHR24021","PTHR24023","PTHR24025","PTHR24027","PTHR24028",
         "PTHR24035")

y <- args[1]

for (name in names){

ids <- read.table(file=sprintf("/home/dgarrido/project/run/blast.ids/%s.blast.ids",name),header=F,sep="\t",as.is=T)[,1]

out <- subset(dict, subset= id%in%ids & year<=y,select=id)

write.table(out,file=sprintf("%s.ids.%s",name,y),col.names=F,row.names=F,quote=F)

}
